<html>
<head>
<title> index </title>
<link rel=stylesheet type="text/css" href="/site-resources/base.css">
<link rel=stylesheet type="text/css" href="/site-resources/pandoc.css">
</head>
<body>
<div class="banner">
<P> <a href="/Home.html">Home</a> | 
    <a href="/About.html">About</a> | 
    <a href="/RecentChanges.html">Recent Changes</a> | 
    <a href="/Documentation.html">Documentation</a> |
    <a href="/Community.html">Community</a>
</div>
<div class="pagecontainer">
<div class="pagesection">
<div id="pagenote">
<p>Feb 2024 - This site, and Kamaelia are <a href="https://github.com/sparkslabs/kamaelia/issues/15">being updated</a>. There is significant work needed, and <a href="https://github.com/sparkslabs/kamaelia/pulls">PRs</a> are welcome.
</div>
<h1 id="project-task-page-dvbtools">Project Task Page: DVBTools</h1>
<div class="boxright">
<p><strong>Status:</strong> Stasis <em>- No other tasks currently requiring further development of these components</em><br />
<strong>Current Developers:</strong> <em>Matt</em><br />
<strong>Current "inflight" dev location:</strong><br />
</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Devices/DVB/</li>
<li>/Code/Python/Kamaelia/Kamaelia/Support/DVB/<br />
</li>
</ul>
<p><strong>Start Date:</strong> 06 May 2006<br />
<strong>Major Milestone date:</strong></p>
<ul>
<li>09 June 2006 : Code to enable Macro demonstrator complete.<br />
</li>
</ul>
<p><strong>Expected End Date:</strong> <em>n/a</em><br />
<strong>End Date:</strong> <em>??</em><br />
<strong>Date this page last updated:</strong> <em>28th November 2006</em><br />
<strong>Estimated effort so far:</strong> ~ 50 days (estimate)<br />
</p>
</div>
<p><strong><br />
</strong></p>
<h2 id="description"><strong>Description</strong></h2>
<p>Components and example code and tools for receiving Digital Video Broadcasting (DVB) transmissions and parsing and handling the MPEG transport stream (TS) contained in it. Particularly with a mind to the creation of television timeshifting tools.<br />
<br />
Using these components it should be relatively simple to instantiate Kamaelia systems capable of using a PC based DVB tuner device to receive an off-air broadcast in real time; extracting audio and video or additional meta data such as "now and next" or "electronic programme guide" (EPG) from the stream.<br />
<br />
Simple examples or tools will demonstrate and explain the ways these components can be used to achieve tasks such as recording programmes.<br />
<br />
Benefits:<br />
</p>
<ul>
<li>Substantial set of extra components providing interesting and useful capabilities (receiving and handling digital TV broadcasts)</li>
<li>Motivation for optimising the throughput of Kamaelia systems to handle the high data rates (up to 10s of Mbits/s)</li>
<li>Enables <a href="/Developers/Projects/KamaeliaMacro">Kamaelia Macro</a> work<br />
</li>
</ul>
<h2 id="inputs">Inputs</h2>
<p>Task Sponsor: TL (BBC internal)<br />
Task Owner: Michael (MPS), Matt (MH)<br />
Developers:<br />
</p>
<ul>
<li>Michael<br />
</li>
<li>Matt<br />
</li>
</ul>
<p>Users:<br />
</p>
<ul>
<li>MPS, MH (direct users of components)</li>
<li>TL, etc (users of systems incorporating them)</li>
</ul>
<p>Interested third parties:<br />
</p>
<ul>
<li>MB, PC (BBC internal)<br />
</li>
</ul>
<p>Requirements:<br />
</p>
<p>MUST be able to operate in real time</p>
<p>MUST be able to tune and receive transport stream from a terrestrial (receive through aerial) DVB PCI or USB tuner.</p>
<p>MUST support Linux</p>
<p>MUST be able to extract transport stream packets with specific packet IDs (PIDs)</p>
<p>MUST be able to extract Event Information Table (EIT) data containing "now &amp; next" information</p>
<p>WOULD LIKE to be able to extract additional meta data, making it possible to:</p>
<ul>
<li>determine the PIDs containing a given service (channel)</li>
<li>map channel names to service IDs</li>
<li>locate and extract subtitling data</li>
<li>extract EPG data for the next 7 days (as broadcast in the UK)<br />
</li>
</ul>
<p>WOULD LIKE to support Mac, Windows<br />
</p>
<p><br />
Relevant Influencing factors:<br />
</p>
<p><em>"python-dvb3" bindings (to Linux DVB API) donated by MB &amp; PC<br />
</em></p>
<p>Relevant standards documentation: (all are publicly available at no charge to the best of my knowledge -- Matt)</p>
<ul>
<li><em>ISO/IEC 13818-1</em> (aka "MPEG: Systems") "Generic Coding of Moving Pictures and Associated Audio: Systems" ISO / Motion Picture Experts Group</li>
<li><em>ETSI EN 300 468</em> "Digital Video Broadcasting (DVB): Specification for Service Information (SI) in DVB systems" ETSI / EBU (DVB group)</li>
<li><em>"Digitial Terrestrial Television: Requirements for Interoperability"</em> Issue 4.0+ (aka "The D book") UK Digital Television Group (DTG)<br />
</li>
</ul>
<h2 id="outputs">Outputs</h2>
<h3 id="expected">Expected</h3>
<p>Code in /Code/Python/Kamaelia/Kamaelia/Device/DVB/:<br />
</p>
<ul>
<li>control a DVB device under Linux (tuning and receiving transport stream packets)</li>
<li>demultiplex transport stream packets (using DVB card facilities)</li>
<li>demultiplex transport stream packets (in software)</li>
<li>extract and parse information tables from the stream</li>
</ul>
<p>Small example code fragments demonstrating functionality provided by components</p>
<p>Example 'tools' demonstrating applications (eg. recording a channel or programme)</p>
<p>Tutorial webpages</p>
<h3 id="actual">Actual</h3>
<p>First iteration code (for Kamaelia Macro initial demonstrator):</p>
<p>Example tools:</p>
<ul>
<li>/Code/Python/Kamaelia/Examples/DVB_Systems/SingleChannelTransportStreamCapture.py</li>
<li>/Code/Python/Kamaelia/Examples/DVB_Systems/TransportStreamCapture.py</li>
<li>/Code/Python/Kamaelia/Examples/DVB_Systems/TransportStreamDemuxer.py</li>
</ul>
<p>Components for controlling tuner device and demultiplexing:<br />
</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Core.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/SoftDemux.py</li>
</ul>
<p>Components for parsing stream metadata:</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/NowNext.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/PSITables.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/EIT.py</li>
</ul>
<p>Second iteration code (post Macro):</p>
<p>Example tools:</p>
<p>/Code/Python/Kamaelia/Examples/DVB_Systems/PersonalVideoRecorder.py</p>
<ul>
<li>uses EPG and other metadata tables to record programmes, specified by programme name and channel name<br />
</li>
</ul>
<p>/Code/Python/Kamaelia/Examples/DVB_Systems/RecordNamedChannel.py</p>
<ul>
<li>uses metadata tables to record a channel, specified by channel name<br />
</li>
</ul>
<p>Components for controlling tuner device and demultiplexing:</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Receiver.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Tuner.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/DemuxerService.py</li>
</ul>
<p>Compoents for parsing stream metadata:</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseEventInformationTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseProgramAssociationTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseNetworkInformationTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseProgramMapTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseServiceDescriptionTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseTimeAndDateTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ParseTimeOffsetTable.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/PrettifyTables.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Device/DVB/Parse/ReassemblePSITables.py</li>
</ul>
<p>Support code (CRC checks &amp; parsing data formats/structures)<br />
</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Support/DVB/CRC.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Support/DVB/DateTime.py</li>
<li>/Code/Python/Kamaelia/Kamaelia/Support/DVB/Descriptors.py</li>
</ul>
<p>Experimental code for making it easier to create and access CAT registered services:<br />
</p>
<ul>
<li>/Code/Python/Kamaelia/Kamaelia/Experimental/Services.py<br />
</li>
</ul>
<h3 id="realistic-possibilities-arising-as-a-result-of-activity-on-this-task">Realistic possibilities arising as a result of activity on this task</h3>
<ul>
<li>Build an Electronic Programme Guide browsing interface</li>
<li>Build a 'traditional' PVR style application, by combining an EPG browsing interface into a UI for scheduling programmes to record for later viewing</li>
<li>Devise code to capable of retuning to a different broadcast multiplex to get to a required TV channel</li>
<li>Build a radio recorder/PVR<br />
</li>
</ul>
<p><br />
</p>
<h2 id="related-tasks">Related Tasks</h2>
<h3 id="tasks-that-directly-enable-this-task-dependencies">Tasks that directly enable this task (dependencies)</h3>
<ul>
<li>Axon optimisations to message passing along linkages.<br />
</li>
</ul>
<h3 id="sub-tasks">Sub Tasks</h3>
<p>For Kamaelia Macro initial demonstrator:<br />
</p>
<ul>
<li>Incorporation of python-dvb3 bindings into mainline</li>
</ul>
<!-- -->
<ul>
<li>Write tuner and demultiplexer components</li>
</ul>
<!-- -->
<ul>
<li>Write Program Status Info (PSI) table parser (enables access to metadata tables)<br />
</li>
</ul>
<!-- -->
<ul>
<li>Write EIT parser to extract Now &amp; Next information<br />
</li>
</ul>
<!-- -->
<ul>
<li>Write optimised software demuliplexer (doesn't use DVB device facilities)<br />
</li>
</ul>
<p>Further work:</p>
<p>Write parsers for remaining metadata table types:</p>
<ul>
<li>Network Information Table (NIT)</li>
<li>Program Association Table (PAT)</li>
<li>Program Map Table (PMT)</li>
<li>Service Description Table (SDT)</li>
<li>Time and Date Table (TDT)</li>
<li>Time Offset Table (TOT)</li>
</ul>
<p>Write prettifiers to make output from table parsers more human readable (for debugging &amp; diagnostic purposes)<br />
</p>
<p>Rewrite PSI parser to behave as a 'service' able to dynamically serve table data to multiple table parsers, as requested</p>
<p>Refactor tuner and demultiplexing components to behave as a 'service' able to dynamically serve packets with particular PIDs, as requested<br />
</p>
<h2 id="task-log">Task Log</h2>
<p>Retrospectively generated entries (no guarantees of completeness!)<br />
<br />
</p>
<ul>
<li>19 January 2006 - Added developer Michael. Checked in experiments into /Sketches/MPS/DVB<br />
</li>
<li>23 January 2006 - Michael : Checked in donated python-dvb3 bindings</li>
<li>17 March 2006 - Michael : Improvements to experiments<br />
</li>
<li>06 May 2006 - Michael : <strong>Task status changed</strong> to running. Developing in /Sketches/MPS/DVB/<br />
</li>
<li>06 May 2006 - Added developer Matt. Developing in /Sketches/MH/DVB_EIT</li>
<li>09 June 2006 - Matt : <strong>Task status changed</strong> to stasis - code necesary for Macro demonstrator complete and working(!)</li>
<li>19 June 2006 - Matt : <strong>Task status changed</strong> to running - Matt continuing work on table parsing.</li>
<li>13 July 2006 - Matt : <strong>Task status changed</strong> to blocked - uncertain what to do next + other stuff: holidays, providing Google SoC support, pymedia components, etc.<br />
</li>
<li>11 September 2006 - Matt : <strong>Task status changed</strong> to running - documenting components and preparing for merge into mainline</li>
<li>13 September 2006 - Matt : 'PVR' example app checked into /Sketches/MH/DVB_PSI<br />
</li>
<li>03 October 2006 - Matt : <strong>Task status changed</strong> to stasis - components documented and merged into mainline</li>
</ul>
<p>Live entries<br />
</p>
<ul>
<li>28 November 2006 - Matt : created this task page<br />
</li>
<li>07 December 2006 - Matt : Fixed long standing software MPEG TS demuxer bug. Time spent 1/2 day.</li>
</ul>
<h2 id="discussion">Discussion</h2>
<p>Upon investigating how to handle metadata tables containing information such as audio and video PID values, channel names etc. it turned out that often the packet IDs containing tables are dynamically set - you need to look it up in another table first.<br />
<br />
This generated the need to modify the demultiplexing components to be able to change what PIDs they extract, and where they send them to, at runtime. Similarly, Matt decided to apply the same logic to the packet-&gt;table data conversion (PSI parsing) step.<br />
<br />
The EIT parsing code was rewritten (1 day) to match the same code design used for parsing all the other tables, and to add the ability to extract the full 7 day programme guide data.<br />
<br />
<br />
</p>

</div> <!-- end section -->
</div> <!-- end page container -->

<div class="banner">
<a href="https://www.bbc.co.uk/rd"><img src="/site-resources/BBCRD_Logo.jpg"></a>
<P id="mini">  Kamaelia is an open source project originated from and guided
by <a href="https://www.bbc.co.uk/rd">BBC Research.</a> For more information
browse the site or get in contact.
<br>This is an ongoing community based development site.  As a result the
contents of this page is the opinions of the contributors of the pages
involved not the organisations involved.  Specificially, this page may
contain personal views which are not the views of the BBC.

<br>(C) Copyright 2004-2024 Kamaelia Contributors, including the British
Broadcasting Corporation, All Rights Reserved.
</div>
</body>
</html>
