<html>
<head>
<title> index </title>
<link rel=stylesheet type="text/css" href="/site-resources/base.css">
<link rel=stylesheet type="text/css" href="/site-resources/pandoc.css">
</head>
<body>
<div class="banner">
<P> <a href="/Home.html">Home</a> | 
    <a href="/About.html">About</a> | 
    <a href="/RecentChanges.html">Recent Changes</a> | 
    <a href="/Documentation.html">Documentation</a> |
    <a href="/Community.html">Community</a>
</div>
<div class="pagecontainer">
<div class="pagesection">
<div id="pagenote">
<p>Feb 2024 - This site, and Kamaelia are <a href="https://github.com/sparkslabs/kamaelia/issues/15">being updated</a>. There is significant work needed, and <a href="https://github.com/sparkslabs/kamaelia/pulls">PRs</a> are welcome.
</div>
<div class="container">
<h1 id="kamaelia.protocol.recoverorder"><a href="/Components/pydoc/Kamaelia.html" class="reference">Kamaelia</a>.<a href="/Components/pydoc/Kamaelia.Protocol.html" class="reference">Protocol</a>.<a href="/Components/pydoc/Kamaelia.Protocol.RecoverOrder.html" class="reference">RecoverOrder</a></h1>
<section>
<div class="container">

</div>
<ul>
<li><a href="#640" class="reference">Recover Order of Sequence Numbered Items</a>
<ul>
<li><a href="#641" class="reference">Example Usage</a></li>
<li><a href="#642" class="reference">Behaviour</a></li>
<li><a href="#643" class="reference">Implementation details</a></li>
</ul></li>
</ul>
</section>
<h1 id="recover-order-of-sequence-numbered-items-640">Recover Order of Sequence Numbered Items {#640}</h1>
<p>Recovers the order of data tagged with sequence numbers. Designed to cope with sequence numbers that have to eventually wrap.</p>
<p>Send (seqnum, data) tuples to the "inbox" inbox and they will be sent out of the "outbox" outbox ordered by ascending sequence number.</p>
<h2 id="example-usage-641"><span id="example-usage">Example Usage</span> {#641}</h2>
<p>Recovering the order of RTP packets received over multicast:</p>
<pre class="literal-block"><code>Pipeline( Multicast_transceiver(&quot;0.0.0.0&quot;, 1600, &quot;224.168.2.9&quot;, 0),
          SimpleDetupler(1),              # discard the source address
          RTPDeframer(),
          RecoverOrder(bufsize=64, modulo=65536),
          SimpleDetupler(1),              # discard sequence numbers
        ).activate()</code></pre>
<h2 id="behaviour-642"><span id="behaviour">Behaviour</span> {#642}</h2>
<p>At initialisation, specify the size of buffer and the modulo (wrapping point) for sequence numbers.</p>
<p>Send (seqnum, data) tuples to the "inbox" inbox and they will be buffered. Once the buffer is full, for every item sent to the "inbox" inbox, one will be emitted from the "outbox" outbox. The ones that are emitted will have been reordered by their sequence number.</p>
<p>You must ensure you choose a sufficiently large buffer size for the expected amount of reordering required. If an item arrives too late, it RecoverOrder will not be able to place it in its correct position in the sequence. It will still be emitted, but out of order.</p>
<p>This component does not terminate. It ignores any messages sent to its "control" inbox.</p>
<h2 id="implementation-details-643"><span id="implementation-details">Implementation details</span> {#643}</h2>
<p>The items are held in an internal buffer. The buffer is always in order - with the earliest sequence number at the front. Once the buffer is full, items are taken out from the front - thereby ensuring any delayed out-of-order items are given every possible chance to make it.</p>
<p>Since sequence numbers eventually wrap, a given sequence number could equally represent a data item that is very late, or very early.</p>
<p>This decision is made about a threshold - which is chosen to be the point in the sequence number line roughly furthest from the sequence numbers of the items in the buffer. This point is the sequence number of the middle item in the buffer, plus modulo/2:</p>
<pre class="literal-block"><code>      Data in the buffer
      .-------^--------.
      &#39;                &#39;
|=====XX=X==XXXXXX=XX==X==================================================|
|             ^                                    ^                      |
0             |                                    |                    modulo
           midpoint                             midpoint
              |                                + modulo/2
|&lt;---LATE----&gt;|&lt;--------------EARLY---------------&gt;|&lt;------------LATE----&gt;|
      A       |                 B                  |              C
                                             (aka. threshold)</code></pre>
<p>Items with a sequence number after this threshold point are deemed to be late (rather than ridiculously early). An item arriving with sequence number B (marked above) has arrived early, and so should be appended to the end of the data items in the buffer. Conversely, items arriving with sequence numbers A or C (also marked above) must be late, so will be inserted at the front of the buffer.</p>
<p>This is implemented by adding modulo to all sequence numbers below the threshold when performing comparisons to determine where to insert the new sequence number into the buffer (the insertion point is found by doing a binary search). You can think of this as moving ranges A and B after range C.</p>
<hr />
<section>

</section>
</div>
<h1 id="feedback">Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer? Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback <a href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701" class="reference">here</a> in reply to the documentation thread in the Kamaelia blog.</p>
<p><em>-- Automatic documentation generator, 05 Jun 2009 at 03:01:38 UTC/GMT</em></p>

</div> <!-- end section -->
</div> <!-- end page container -->

<div class="banner">
<a href="https://www.bbc.co.uk/rd"><img src="/site-resources/BBCRD_Logo.jpg"></a>
<P id="mini">  Kamaelia is an open source project originated from and guided
by <a href="https://www.bbc.co.uk/rd">BBC Research.</a> For more information
browse the site or get in contact.
<br>This is an ongoing community based development site.  As a result the
contents of this page is the opinions of the contributors of the pages
involved not the organisations involved.  Specificially, this page may
contain personal views which are not the views of the BBC.

<br>(C) Copyright 2004-2024 Kamaelia Contributors, including the British
Broadcasting Corporation, All Rights Reserved.
</div>
</body>
</html>
