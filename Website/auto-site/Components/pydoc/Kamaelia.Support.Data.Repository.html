<html>
<head>
<title> index </title>
<link rel=stylesheet type="text/css" href="/site-resources/base.css">
<link rel=stylesheet type="text/css" href="/site-resources/pandoc.css">
</head>
<body>
<div class="banner">
<P> <a href="/Home.html">Home</a> | 
    <a href="/About.html">About</a> | 
    <a href="/RecentChanges.html">Recent Changes</a> | 
    <a href="/Documentation.html">Documentation</a> |
    <a href="/Community.html">Community</a>
</div>
<div class="pagecontainer">
<div class="pagesection">
<div id="pagenote">
<p>March 2024 - This site, and Kamaelia are <a href="https://github.com/sparkslabs/kamaelia/issues/15">being updated</a>. There is significant work needed, and <a href="https://github.com/sparkslabs/kamaelia/pulls">PRs</a> are welcome.
</div>
<div class="container">
<h1 id="kamaelia.support.data.repository"><a
href="/Components/pydoc/Kamaelia.html" class="reference">Kamaelia</a>.<a
href="/Components/pydoc/Kamaelia.Support.html"
class="reference">Support</a>.<a
href="/Components/pydoc/Kamaelia.Support.Data.html"
class="reference">Data</a>.<a
href="/Components/pydoc/Kamaelia.Support.Data.Repository.html"
class="reference">Repository</a></h1>
<section>
<div class="container">

</div>
<ul>
<li><a href="#42" class="reference">Kamaelia component repository
introspection</a>
<ul>
<li><a href="#43" class="reference">Example Usage</a>
<ul>
<li><a href="#44" class="reference">Simple lists of component/prefab
names</a></li>
<li><a href="#45" class="reference">Detailed introspections::</a></li>
</ul></li>
<li><a href="#46" class="reference">Obtaining introspection
data</a></li>
<li><a href="#47" class="reference">How are components and prefabs
detected?</a></li>
<li><a href="#48" class="reference">Structure of detailed
introspections</a></li>
<li><a href="#49" class="reference">Implementation Details</a></li>
</ul></li>
</ul>
</section>
<h1 id="42">Kamaelia component repository introspection</h1>
<p>This support code scans through a Kamaelia installation detecting
components and picking up relevant information such as doc strings,
initializer arguments and the declared Inboxes and Outboxes.</p>
<p>It not only detects components and prefabs, but also picks up
modules, classes and functions - making this a good source for
documentation generation.</p>
<h2 id="43"><span id="example-usage">Example Usage</span></h2>
<h3 id="44"><span id="simple-lists-of-component-prefab-names">Simple
lists of component/prefab names</span></h3>
<p>Fetch a flat listing of all components. The key is the module path
(as a tuple) and the value is a list of the names of the components
found:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; r=Repository.GetAllKamaeliaComponents()
&gt;&gt;&gt; r[(&#39;Kamaelia&#39;,&#39;Util&#39;,&#39;Console&#39;)]
[&#39;ConsoleEchoer&#39;, &#39;ConsoleReader&#39;]</code></pre>
<p>Fetch a <em>nested</em> listing of all components. The leaf is a list
of entity names:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; r=Repository.GetAllKamaeliaComponentsNested()
&gt;&gt;&gt; r[&#39;Kamaelia&#39;][&#39;Util&#39;][&#39;Console&#39;]
[&#39;ConsoleEchoer&#39;, &#39;ConsoleReader&#39;]</code></pre>
<p>Fetch a flat listing of all prefabs:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; p=Repository.GetAllKamaeliaPrefabs()
&gt;&gt;&gt; p[(&#39;Kamaelia&#39;,&#39;File&#39;,&#39;Reading&#39;)]
[&#39;RateControlledFileReader&#39;, &#39;RateControlledReusableFileReader&#39;,
&#39;ReusableFileReader&#39;, &#39;FixedRateControlledReusableFileReader&#39;]</code></pre>
<p>Fetch a <em>nested</em> listing of all prefabs:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; p=Repository.GetAllKamaeliaPrefabsNested()
&gt;&gt;&gt; p[&#39;Kamaelia&#39;][&#39;File&#39;][&#39;Reading&#39;]
[&#39;RateControlledFileReader&#39;, &#39;RateControlledReusableFileReader&#39;,
&#39;ReusableFileReader&#39;, &#39;FixedRateControlledReusableFileReader&#39;]</code></pre>
<p>Fetching a flat listing of components as defined in a specific
directory (rather than the current Kamaelia installation):</p>
<pre class="literal-block"><code>&gt;&gt;&gt; r=Repository.GetAllKamaeliaComponents(baseDir=&quot;/data/my-projects/my-components/&quot;)</code></pre>
<h3 id="45"><span id="detailed-introspections">Detailed
introspections::</span></h3>
<p>We can ask for a complete introspection of the current Kamaelia
installation:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; docTree=Repository.ModuleDoc(&quot;Kamaelia&quot;,&quot;/usr/lib/python/site-packages/Kamaelia&quot;)
&gt;&gt;&gt; docTree.resolve(roots={&quot;Kamaelia&quot;:docTree})</code></pre>
<p>And look up a particular module:</p>
<pre class="literal-block"><code> &gt;&gt;&gt; m=docTree.find(&quot;Util.Console&quot;)
 &gt;&gt;&gt; m
&lt;Repository.ModuleDoc object at 0x40403b0c&gt;</code></pre>
<p>Then find components declared in that module:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; cs=m.listAllComponents()
&gt;&gt;&gt; cs
[(&#39;ConsoleReader&#39;, &lt;Repository.ClassScope object at 0x41511bac&gt;), (&#39;ConsoleEchoer&#39;, &lt;Repository.ClassScope object at 0x4115990c&gt;)]
&gt;&gt;&gt; (name,c)=cs[0]
&gt;&gt;&gt; name
&#39;ConsoleReader&#39;
&gt;&gt;&gt; c
&lt;Repository.ClassScope object at 0x41511bac&gt;</code></pre>
<p>And look at properties of that component:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; c.module
&#39;Kamaelia.Util.Console&#39;
&gt;&gt;&gt; c.inboxes
{&#39;control&#39;: &#39;NOT USED&#39;, &#39;inbox&#39;: &#39;NOT USED&#39;}
&gt;&gt;&gt; c.outboxes
{&#39;outbox&#39;: &#39;Lines that were typed at the console&#39;, &#39;signal&#39;: &#39;NOT USED&#39;}
&gt;&gt;&gt; print c.doc
ConsoleReader([prompt][,eol]) -&gt; new ConsoleReader component.

Component that provides a console for typing in stuff. Each line is output
from the &quot;outbox&quot; outbox one at a time.

Keyword arguments:

- prompt  -- Command prompt (default=&quot;&gt;&gt;&gt; &quot;)
- eol     -- End of line character(s) to put on end of every line outputted (default is newline)</code></pre>
<p>This includes methods defined in it:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; c.listAllFunctions()
[(&#39;main&#39;, &lt;Repository.FunctionScope object at 0x4166822c&gt;), (&#39;__init__&#39;, &lt;Repository.FunctionScope object at 0x4166224c&gt;)]
&gt;&gt;&gt; name,f=c.listAllFunctions()[1]
&gt;&gt;&gt; name
&#39;__init__&#39;
&gt;&gt;&gt; f
&lt;Repository.FunctionScope object at 0x4166224c&gt;</code></pre>
<p>We can look at the docs for the function:</p>
<blockquote>
<pre class="doctest-block"><code>&gt;&gt;&gt; f.doc
&#39;x.__init__(...) initializes x; see x.__class__.__doc__ for signature&#39;</code></pre>
</blockquote>
<p>We can ask for a string summarising the method's arguments:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; f.argString
&#39;self[, prompt][, eol]&#39;</code></pre>
<p>Or a list naming each argument, consisting of (argname,
summary-representation) pairs:</p>
<pre class="literal-block"><code>&gt;&gt;&gt; f.args
[(&#39;self&#39;, &#39;self&#39;), (&#39;prompt&#39;, &#39;[prompt]&#39;), (&#39;eol&#39;, &#39;[eol]&#39;)]</code></pre>
<h2 id="46"><span id="obtaining-introspection-data">Obtaining
introspection data</span></h2>
<p>To get a detailed introspection you create a ModuleDoc object. You
can either point it at a specific directory, or just let it introspect
the currently installed Kamaelia repository.</p>
<p>You can specify the module path corresponding to that directory (the
"root name"). The default is simply "Kamaelia". If for example, you
point it at the <a href="/Components/pydoc/Kamaelia.Chassis.html"
class="reference">Kamaelia.Chassis</a> directory; you should explain
that the root name is "<a href="/Components/pydoc/Kamaelia.Chassis.html"
class="reference">Kamaelia.Chassis</a>". Or if, for example, you are
using this code to document <a href="/Docs/Axon/Axon.html"
class="reference">Axon</a>, you would specify a root name of "<a
href="/Docs/Axon/Axon.html" class="reference">Axon</a>".</p>
<p>After instantiating your ModuleDoc object; remember to call its
"resolve" method to allow it to resolve references to base classes, and
determine method the resolution order for classes.</p>
<h2 id="47"><span id="how-are-components-and-prefabs-detected">How are
components and prefabs detected?</span></h2>
<p>Components and prefabs are detected in sourcefiles by looking for
declarations of an __kamaelia_components__ and __kamaelia_prefabs__
variables, for example:</p>
<pre class="literal-block"><code>__kamaelia_components__ = [ &quot;IcecastClient&quot;, &quot;IcecastDemux&quot;, &quot;IcecastStreamWriter&quot; ]
__kamaelia_prefabs__ = [ &quot;IcecastStreamRemoveMetadata&quot; ]</code></pre>
<p>They should be declared individually, at module level, and should
consist of a simple list of strings giving the names of the
components/prefabs present.</p>
<h2 id="48"><span id="structure-of-detailed-introspections">Structure of
detailed introspections</span></h2>
<p>The introspection is a hierarchy of Scope objects, each representing
a delcaration scope - such as a module, class, function, etc. These are
built up to reflect the structure of the library if it is imported.</p>
<ul>
<li><p>ModuleDoc objects represent each module. They may contain:</p>
<blockquote>
<ul>
<li>Other ModuleDoc objects</li>
<li>ImportScope objects</li>
<li>ClassScope objects (representing classes and components)</li>
<li>FunctionScope objects (repesenting functions and prefabs)</li>
<li>UnparsedScope objects (anything that wasn't parsed)</li>
</ul>
</blockquote></li>
</ul>
<p>ClassScope and FunctionScope objects may also contain any of these.
For example, methods in a class will be represented as FunctionScope
objects within the ClassScope object.</p>
<p>The find() method of any given scope can be used to lookup a symbol
in that scope, or its children. For example, you could call find() on
the "<a href="/Components/pydoc/Kamaelia.Chassis.html"
class="reference">Kamaelia.Chassis</a>" ModuleDoc object with the
argument "Graphline.Graphline" to retrieve the graphline component (its
full path is "<a
href="/Components/pydoc/Kamaelia.Chassis.Graphline.Graphline.html"
class="reference">Kamaelia.Chassis.Graphline.Graphline</a>")</p>
<p>The listAllXXXXX() methods enumerate items - such as classes,
functions, components, prefabs or modules.</p>
<h2 id="49"><span id="implementation-details">Implementation
Details</span></h2>
<p>This code uses the python compiler.ast module to parse the source of
python files, rather than import them. This allows introspection of code
that might not necessarily run on the system at hand - perhaps because
not all dependancies can be satisfied.</p>
<p>Basic tracking of assignment operations is performed, so the
following is fair game:</p>
<pre class="literal-block"><code>from Axon.Component import component as flurble

class Boo(flurble):
    pass

Foo=Boo</code></pre>
<p>However anything more comple is not processed. For example, functions
and classes declared within "if" statement will not be found:</p>
<pre class="literal-block"><code>if 1:
    class WillNotBeDetected:
        pass

    def AlsoWillNotBeDetected():
        pass</code></pre>
<p>The simplified functions that only return lists of component/prefab
names ( GetAllKamaeliaComponentsNested, GetAllKamaeliaComponents,
GetAllKamaeliaPrefabsNested and GetAllKamaeliaPrefabs) simply run the
full introspection of the codebase but then throw most of the
information away.</p>
<hr />
<section>

</section>
</div>
<h1 id="feedback">Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be
clearer? Want to help improve it? Constructive criticism is very welcome
- especially if you can suggest a better rewording!</p>
<p>Please leave you feedback <a
href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701"
class="reference">here</a> in reply to the documentation thread in the
Kamaelia blog.</p>
<p><em>-- Automatic documentation generator, 05 Jun 2009 at 03:01:38
UTC/GMT</em></p>

</div> <!-- end section -->
</div> <!-- end page container -->

<div class="banner">
<a href="https://www.bbc.co.uk/rd"><img src="/site-resources/BBCRD_Logo.jpg"></a>
<P id="mini">  Kamaelia is an open source project originated from and guided
by <a href="https://www.bbc.co.uk/rd">BBC Research.</a> For more information
browse the site or get in contact.
<br>This is an ongoing community based development site.  As a result the
contents of this page is the opinions of the contributors of the pages
involved not the organisations involved.  Specificially, this page may
contain personal views which are not the views of the BBC.

<br>(C) Copyright 2004-2024 Kamaelia Contributors, including the British
Broadcasting Corporation, All Rights Reserved.
</div>
</body>
</html>
