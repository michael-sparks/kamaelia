<html>
<head>
<title> index </title>
<link rel=stylesheet type="text/css" href="/site-resources/base.css">
<link rel=stylesheet type="text/css" href="/site-resources/pandoc.css">
</head>
<body>
<div class="banner">
<P> <a href="/Home.html">Home</a> | 
    <a href="/About.html">About</a> | 
    <a href="/RecentChanges.html">Recent Changes</a> | 
    <a href="/Documentation.html">Documentation</a> |
    <a href="/Community.html">Community</a>
</div>
<div class="pagecontainer">
<div class="pagesection">
<div id="pagenote">
<p>March 2024 - This site, and Kamaelia are <a href="https://github.com/sparkslabs/kamaelia/issues/15">being updated</a>. There is significant work needed, and <a href="https://github.com/sparkslabs/kamaelia/pulls">PRs</a> are welcome.
</div>
<h1 id="cookbook-backplanes">Cookbook : Backplanes</h1>
<p>Backplanes provide an easy way to distribute data from many sources
to many destinations. For example<br />
</p>
<h3 id="serving-to-multiple-clients">Serving to multiple clients</h3>
<p>For example, perhaps we want to build a server where each client that
connects receives a copy of a stream of data - perhaps the current time.
First, lets create our source of time data:</p>
<blockquote>
<pre><code>from Axon.ThreadedComponent import threadedcomponent
import time

class TimeTick(threadedcomponent):
    def main(self):
        prev=&quot;&quot;
        while 1:
            now = time.asctime() + &quot;\n&quot;
            if now!=prev:
                self.send(now, &quot;outbox&quot;)
                prev=now
            else:
                self.pause(0.1)</code></pre>
</blockquote>
<p>We're going to use SimpleServer to provide a simple TCP server to
clients. Every time a client connects, we could make a new, private
instance of TimeTick to handle that client. Alternatively we could make
a single TimeTick component that sends (publishes) its messages to a
Backplane:<br />
<br />
</p>
<blockquote>
<pre><code>from Kamaelia.Util.Backplane import Backplane
from Kamaelia.Util.Backplane import PublishTo
from Kamaelia.Chassis.Pipeline import Pipeline

Backplane(&quot;TIME&quot;).activate()

Pipeline( TimeTick(),
          PublishTo(&quot;TIME&quot;),
        ).activate()</code></pre>
</blockquote>
<p>Then for each client that connects, we ask SimpleServer to make a
component that fetches (subscribes) from that same backplane:<br />
<br />
</p>
<blockquote>
<pre><code>from Kamaelia.Util.Backplane import SubscribeTo
from Kamaelia.Chassis.ConnectedServer import SimpleServer

SimpleServer(protocol=lambda : SubscribeTo(&quot;TIME&quot;), port=1500).run()</code></pre>
</blockquote>
<h3 id="so-whats-going-on">So what's going on?</h3>
<p>Notice we've named the Backplane "TIME" to distinguish it from other
Backplanes. You can therefore have as many Backplanes in a system as you
like. The SubscribeTo and PublishTo components connect to the right
backplane because they look it up (by the name) using the Coordinating
Assistant Tracker (CAT). Once the subscribers and publishers are all
linked up, you get something like this:<br />
<br />
</p>
<div data-align="center">
<p><img src="/images/backplane1.gif"
alt="PublishTo components send data to the Backplane. The Backplane then sends it onto ALL SubscribeTo components subscribed to it." /><br />
</p>
</div>
<p><br />
PublishTo components send anything that arrives at their "inbox" inbox
onto the Backplane. SubscribeTo components talk to the backplane and
send on anything they receive from it to their "outbox" outbox. The
Backplane itself acts like a splitter component - anything it receives
is sent onto all outputs; in this case - all subscribers.<br />
</p>
<h3 id="couldnt-we-have-done-that-more-simply">Couldn't we have done
that more simply?</h3>
<p>For a really simple example like this, there is little or no benefit
of doing it this way ... in fact, it might seem like unnecessary extra
effort and components! However, the real power is that all the clients
are sharing the same data source.</p>
<h3 id="a-simple-relay-server">A simple relay server</h3>
<p>Perhaps, for example, our source of data is actually coming from
another server (say "foo.bar.com" on port 1600). Using a backplane, its
easy to build a relay server capable of replicating the data to multiple
clients:</p>
<blockquote>
<pre><code>from Kamaelia.Internet.TCPClient import TCPClient

Pipeline( TCPClient(&quot;foo.bar.com&quot;, port=1600),
          PublishTo(&quot;DATA&quot;),
        ).activate()

Backplane(&quot;DATA&quot;).activate()

SimpleServer(protocol=lambda : SubscribeTo(&quot;DATA&quot;), port=1600).run()</code></pre>
</blockquote>
<h3 id="an-aggregating-logger...">An aggregating logger...</h3>
<p>Backplanes aren't just useful for distributing data in a one-to-many
fashion; they can also be used for many-to-one or many-to-many. For
example, we can use a Backplane to build a logging server capable of
logging, to a single file, data received from multiple clients. In
effect, a simple aggregating logger:</p>
<blockquote>
<pre><code>from Kamaelia.Visualisation.PhysicsGraph.chunks_to_lines import chunks_to_lines
from Kamaelia.File.Writing import SimpleFileWriter

def sendToBackplane():
    return Pipeline( chunks_to_lines(),
                      PublishTo(&quot;LOGGER&quot;),
                    )

SimpleServer(protocol=sendToBackplane, port=1500).activate()

Pipeline( SubscribeTo(&quot;LOGGER&quot;),
          SimpleFileWriter(&quot;log.data&quot;),
        ).activate()

Backplane(&quot;LOGGER&quot;).run()</code></pre>
</blockquote>
<h3 id="that-can-also-be-a-relay">...that can also be a relay</h3>
<p>Because we use a Backplane and a SimpleServer chassis, the client
connections are not hard wired - clients can connect and disconnect
whenever they choose. In fact, we could extend this further, by allowing
clients to connect on a different port to receive a live stream of the
aggregated logging data:</p>
<blockquote>
<pre><code>SimpleServer(protocol=SubscribeTo(&quot;LOGGER&quot;), port=1501).activate()</code></pre>
</blockquote>
<p>Our aggregating logger is now also a relay, using the backplane to
distribute messages from many sources to many destinations.</p>
<p><br />
-- Jan 2007, Matt<br />
</p>

</div> <!-- end section -->
</div> <!-- end page container -->

<div class="banner">
<a href="https://www.bbc.co.uk/rd"><img src="/site-resources/BBCRD_Logo.jpg"></a>
<P id="mini">  Kamaelia is an open source project originated from and guided
by <a href="https://www.bbc.co.uk/rd">BBC Research.</a> For more information
browse the site or get in contact.
<br>This is an ongoing community based development site.  As a result the
contents of this page is the opinions of the contributors of the pages
involved not the organisations involved.  Specificially, this page may
contain personal views which are not the views of the BBC.

<br>(C) Copyright 2004-2024 Kamaelia Contributors, including the British
Broadcasting Corporation, All Rights Reserved.
</div>
</body>
</html>
